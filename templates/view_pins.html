{% extends "base.html" %}

        {% if data.get('archive_type') == 'full_messages' %}
            📦 #{{ data.channel_name }}
        {% else %}
            📌 #{{ data.channel_name }}
        {% endif %}ock content %}
<div style="margin-bottom: 20px;">
    <a href="{{ url_for('index') }}" class="btn btn-seconda            <!-- Reactions -->
            {% if item.reactions %}
            <div style="margin-bottom: 15px;">
                <h4 style="margin-bottom: 10px; color: #333;">💝 Reactions:</h4>
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    {% for reaction in item.reactions %}
                    <span style="background-color: #f0f0f0; padding: 4px 8px; border-radius: 12px; font-size: 14px;">
                        {{ reaction.emoji }} {{ reaction.count }}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Message metadata -->
            <div style="font-size: 12px; color: #888; border-top: 1px solid #eee; padding-top: 10px;">
                Message ID: {{ item.id }} • Created: {{ item.created_at[:19].replace('T', ' ') }}
                {% if item.get('is_pinned') %}• 📌 Pinned{% endif %}
            </div>Archives</a>
</div>

<div style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; background-color: #f8f9fa; margin-bottom: 20px;">
    <h2 style="color: #5865f2; margin-bottom: 10px;">
        {% if data.archive_type == 'full_messages' %}
            📦 #{{ data.channel_name }}
        {% else %}
            � #{{ data.channel_name }}
        {% endif %}
    </h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 14px; color: #666;">
        <div><strong>Archive Date:</strong> {{ (data.reset_timestamp or data.archive_timestamp)[:19].replace('T', ' ') }}</div>
        {% if data.get('archive_type') == 'full_messages' %}
            <div><strong>Total Messages:</strong> {{ data.get('message_count', 0) }}</div>
        {% else %}
            <div><strong>Total Pins:</strong> {{ data.get('pin_count', 0) }}</div>
        {% endif %}
        <div><strong>Archive File:</strong> {{ filename }}</div>
    </div>
</div>

{% set items = data.messages if data.get('archive_type') == 'full_messages' else data.get('pins', []) %}
{% if items %}
    <div style="display: grid; gap: 20px;">
        {% for item in items %}
        <div style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; background-color: white;">
            <!-- Author info -->
            <div style="display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                {% if item.author.avatar_url %}
                <img src="{{ item.author.avatar_url }}" alt="Avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 12px;">
                {% else %}
                <div style="width: 40px; height: 40px; border-radius: 50%; background-color: #5865f2; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 12px;">
                    {{ item.author.name[0].upper() }}
                </div>
                {% endif %}
                <div>
                    <div style="font-weight: bold; color: #333;">
                        {{ item.author.name }}
                        {% if item.get('is_pinned') %}
                            📌
                        {% endif %}
                    </div>
                    <div style="font-size: 12px; color: #666;">{{ item.created_at[:19].replace('T', ' ') }}</div>
                </div>
            </div>

            <!-- Message content -->
            {% if item.content %}
            <div style="margin-bottom: 15px; line-height: 1.5; white-space: pre-wrap;">{{ item.content }}</div>
            {% else %}
            <div style="margin-bottom: 15px; font-style: italic; color: #666;">
                {% if item.attachments %}
                    <em>This message contains attachments but no text content.</em>
                {% elif item.embeds %}
                    <em>This message contains embeds but no text content.</em>
                {% else %}
                    <em>This message has no text content, attachments, or embeds.</em>
                {% endif %}
            </div>
            {% endif %}

            <!-- Attachments -->
            {% if item.attachments %}
            <div style="margin-bottom: 15px;">
                <h4 style="margin-bottom: 10px; color: #333;">📎 Attachments ({{ item.attachments|length }}):</h4>
                <div style="display: grid; gap: 10px;">
                    {% for attachment in item.attachments %}
                    <div style="border: 1px solid #ddd; border-radius: 5px; padding: 12px; background-color: #f8f9fa;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold;">{{ attachment.filename }}</div>
                                <div style="font-size: 12px; color: #666;">
                                    {% if attachment.size %}
                                        {{ "%.2f"|format(attachment.size / 1024 / 1024) }} MB
                                    {% endif %}
                                    {% if attachment.content_type %}
                                        • {{ attachment.content_type }}
                                    {% endif %}
                                    {% if attachment.downloaded %}
                                        • ✅ Saved locally
                                    {% elif attachment.get('downloaded') == false %}
                                        • ❌ Download failed
                                    {% endif %}
                                </div>
                            </div>
                            {% if attachment.downloaded and attachment.local_filename %}
                                <a href="{{ url_for('serve_attachment', filename=attachment.local_filename) }}" target="_blank" class="btn" style="padding: 6px 12px; font-size: 14px;">
                                    View/Download
                                </a>
                            {% else %}
                                <a href="{{ attachment.original_url or attachment.url }}" target="_blank" class="btn btn-secondary" style="padding: 6px 12px; font-size: 14px;">
                                    Original URL
                                </a>
                            {% endif %}
                        </div>
                        {% if attachment.content_type and attachment.content_type.startswith('image/') %}
                        <div style="margin-top: 10px;">
                            {% if attachment.downloaded and attachment.local_filename %}
                                <img src="{{ url_for('serve_attachment', filename=attachment.local_filename) }}" alt="{{ attachment.filename }}" style="max-width: 100%; max-height: 300px; border-radius: 4px;">
                            {% else %}
                                <img src="{{ attachment.original_url or attachment.url }}" alt="{{ attachment.filename }}" style="max-width: 100%; max-height: 300px; border-radius: 4px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <div style="display: none; padding: 20px; background-color: #f0f0f0; border-radius: 4px; text-align: center; color: #666;">
                                    <p>🖼️ Image no longer available</p>
                                    <p style="font-size: 12px;">Original: {{ attachment.filename }}</p>
                                </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Embeds -->
            {% if item.embeds %}
            <div style="margin-bottom: 15px;">
                <h4 style="margin-bottom: 10px; color: #333;">📄 Embeds ({{ item.embeds|length }}):</h4>
                {% for embed in item.embeds %}
                <div style="border-left: 4px solid #5865f2; padding: 12px; background-color: #f8f9fa; margin-bottom: 10px; border-radius: 4px;">
                    {% if embed.title %}
                    <div style="font-weight: bold; margin-bottom: 8px; color: #333;">{{ embed.title }}</div>
                    {% endif %}
                    {% if embed.description %}
                    <div style="margin-bottom: 8px; color: #555;">{{ embed.description }}</div>
                    {% endif %}
                    {% if embed.url %}
                    <div style="font-size: 12px;">
                        <a href="{{ embed.url }}" target="_blank" style="color: #5865f2;">{{ embed.url }}</a>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Reactions -->
            {% if pin.reactions %}
            <div style="margin-bottom: 10px;">
                <h4 style="margin-bottom: 8px; color: #333;">👍 Reactions:</h4>
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    {% for reaction in pin.reactions %}
                    <span style="background-color: #f0f0f0; padding: 4px 8px; border-radius: 12px; font-size: 14px;">
                        {{ reaction.emoji }} {{ reaction.count }}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Pin metadata -->
            <div style="font-size: 12px; color: #888; border-top: 1px solid #eee; padding-top: 10px;">
                Pin ID: {{ pin.id }} • Created: {{ pin.created_at[:19].replace('T', ' ') }}
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div style="text-align: center; padding: 40px; color: #666;">
        <h3>No pins found in this archive</h3>
    </div>
{% endif %}
{% endblock %}